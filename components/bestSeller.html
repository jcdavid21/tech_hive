<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Seller</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../styles/general.css">
    <link rel="stylesheet" href="../styles/navbar.css">
    <link rel="stylesheet" href="../styles/footer.css">
    <link rel="stylesheet" href="../styles/bestSeller.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="img-con">
                <img src="/assets/logo.jpeg" alt="Logo">
            </div>
        </div>

        <!-- Mobile Toggle Button -->
        <button class="mobile-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Search Bar Section -->
        <div class="search-section">
            <div class="search-bar">
                <input type="text" placeholder="Search products..." id="searchInput">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <!-- Navigation Section -->
        <div class="nav-section" id="navSection">
            <ul class="nav-links">
                <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="products.html"><i class="fas fa-box"></i> Products</a></li>
                <li><a href="bestSeller.html" class="active"><i class="fas fa-star"></i> Best Seller</a></li>
                <li><a href="aboutUs.html"><i class="fas fa-info-circle"></i> About Us</a></li>
                <li>
                    <a href="cart.html" class="cart-link">
                        <i class="fas fa-shopping-cart"></i> Cart
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </li>
                <li><a href="login.html" id="profileLink"><i class="fas fa-user"></i> <span id="profileText">Log In</span></a></li>
            </ul>
        </div>
    </nav>

    <!-- Best Seller Content -->
    <main class="bestseller-container">

        <!-- Main Content -->
        <section class="trending-section">
            <div class="container">
                <!-- Section Header -->
                <div class="section-header">
                    <h2>Top Rated Products</h2>
                    <p>These are our best-selling products based on customer reviews, sales volume, and satisfaction ratings</p>
                </div>

                <!-- Bestseller Metrics -->
                <div class="bestseller-metrics">
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="metric-title">Premium Quality</div>
                            <div class="metric-desc">Carefully curated products that exceed expectations</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="metric-title">Customer Favorite</div>
                            <div class="metric-desc">Most loved products by our community</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="metric-title">Top Rated</div>
                            <div class="metric-desc">Highest customer satisfaction ratings</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="metric-title">Fast Delivery</div>
                            <div class="metric-desc">Quick and reliable shipping worldwide</div>
                        </div>
                    </div>
                </div>

                <!-- Filter Controls -->
                <div class="bestseller-controls">
                    <button class="control-btn active" data-category="all">All Best Sellers</button>
                    <button class="control-btn" data-category="smartphones">Smartphones</button>
                    <button class="control-btn" data-category="laptops">Laptops</button>
                    <button class="control-btn" data-category="headphones">Audio</button>
                    <button class="control-btn" data-category="smartwatch">Wearables</button>
                    <button class="control-btn" data-category="console">Gaming</button>
                </div>

                <!-- Loading State -->
                <div class="loading" id="loadingState">
                    <div class="spinner"></div>
                    <p>Loading best sellers...</p>
                </div>

                <!-- Products Grid -->
                <div class="product-grid" id="productGrid">
                    <!-- Products will be populated here -->
                </div>

                <!-- No Products Message -->
                <div class="no-products" id="noProducts" style="display: none;">
                    <i class="fas fa-star"></i>
                    <h3>No best sellers found</h3>
                    <p>Try selecting a different category to see our top products</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Social Media</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="aboutUs.html">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="support.html">Support</a></li>
                        <li><a href="contactUs.html">Contact Us</a></li>
                        <li><a href="termsCondition.html">Terms and Condition</a></li>
                        <li><a href="privacyPolicy.html">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-phone"></i> +63 976 209 6892</p>
                    <p><i class="fas fa-envelope"></i> Techive@gmail.com</p>
                    <p><i class="fas fa-map-marker-alt"></i> Our Lady Of Fatima University</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Premium Store. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Import products data -->
    <script src="../js/items.js"></script>
    
    <script>
        // Global variables
        let allProducts = [];
        let bestSellerProducts = [];
        let filteredProducts = [];
        let currentCategory = 'all';

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadBestSellers();
            setupEventListeners();
            updateCartCount();
        });

        // Load best seller products
        function loadBestSellers() {
            try {
                if (typeof products !== 'undefined' && Array.isArray(products)) {
                    allProducts = products;
                    
                    // Filter best sellers (products with high ratings and best seller badges)
                    bestSellerProducts = allProducts.filter(product => {
                        const isBestSeller = product.badge === 'Best Seller' || 
                                           product.badge === 'Premium' || 
                                           product.badge === 'Hot Deal' ||
                                           product.rating >= 4.5;
                        return isBestSeller;
                    });

                    // Sort by rating and add ranking
                    bestSellerProducts.sort((a, b) => b.rating - a.rating);
                    bestSellerProducts.forEach((product, index) => {
                        product.rank = index + 1;
                    });

                    filteredProducts = [...bestSellerProducts];
                    displayProducts();
                    hideLoading();
                } else {
                    throw new Error('Products data not found');
                }
            } catch (error) {
                console.error('Error loading best sellers:', error);
                showNoProducts('Error loading best sellers. Please try again later.');
                hideLoading();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            const controlBtns = document.querySelectorAll('.control-btn');
            const searchInput = document.getElementById('searchInput');

            controlBtns.forEach(btn => {
                btn.addEventListener('click', handleCategoryChange);
            });

            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
            }
        }

        // Handle category filter change
        function handleCategoryChange(e) {
            // Remove active class from all buttons
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            e.target.classList.add('active');
            
            currentCategory = e.target.getAttribute('data-category');
            filterAndDisplayProducts();
        }

        // Handle search input
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            if (searchTerm) {
                filteredProducts = bestSellerProducts.filter(product =>
                    product.title.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm)
                );
            } else {
                filteredProducts = [...bestSellerProducts];
            }
            
            // Apply category filter if not "all"
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.category === currentCategory
                );
            }
            
            displayProducts();
        }

        // Filter and display products
        function filterAndDisplayProducts() {
            // Start with best sellers
            filteredProducts = [...bestSellerProducts];

            // Apply category filter
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.category === currentCategory
                );
            }

            displayProducts();
        }

        // Display products in the grid
        function displayProducts() {
            const productGrid = document.getElementById('productGrid');
            const noProducts = document.getElementById('noProducts');

            if (filteredProducts.length === 0) {
                productGrid.style.display = 'none';
                noProducts.style.display = 'block';
                return;
            }

            productGrid.style.display = 'grid';
            noProducts.style.display = 'none';

            productGrid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');

            // Add event listeners to add to cart buttons
            addCartEventListeners();
        }

        // Create HTML for a single product card
        function createProductCard(product) {
            const savings = product.originalPrice ? 
                Math.round(((parseFloat(product.originalPrice) - parseFloat(product.price)) / parseFloat(product.originalPrice)) * 100) : 0;
            
            const stars = generateStars(product.rating);
            const badgeClass = product.badge ? product.badge.toLowerCase().replace(/\s+/g, '-') : '';

            return `
                <div class="product-card" data-product-id="${product.id}">
                    <div class="product-image">
                        <img src="../assets/products/${product.imageUrl}" alt="${product.title}" loading="lazy">
                        ${product.badge ? `<span class="product-badge ${badgeClass}">${product.badge}</span>` : ''}
                        ${product.rank ? `<div class="bestseller-rank">${product.rank}</div>` : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-price">
                            ${product.price}
                            ${product.originalPrice ? `<span class="original-price">$${product.originalPrice}</span>` : ''}
                        </div>
                        ${savings > 0 ? `<div class="savings">Save ${savings}%!</div>` : ''}
                        <div class="product-rating">
                            <div class="rating-stars">${stars}</div>
                            <span class="rating-count">(${product.ratingCount})</span>
                        </div>
                        <button class="product-btn">Add to Cart</button>
                        
                        <!-- Hidden elements for data extraction -->
                        <div class="hidden-features" style="display: none;">
                            <input type="hidden" class="description" value="${product.description}">
                            ${product.feature ? product.feature.map(feature => `<input type="hidden" class="feature" value="${feature}">`).join('') : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate star rating HTML
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

            let starsHTML = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<i class="fas fa-star"></i>';
            }
            
            // Half star
            if (hasHalfStar) {
                starsHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<i class="far fa-star"></i>';
            }
            
            return starsHTML;
        }

        // Add event listeners to cart buttons
        function addCartEventListeners() {
            const productBtns = document.querySelectorAll('.product-btn');
            
            productBtns.forEach((btn) => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const productCard = this.closest('.product-card');
                    const productTitle = productCard.querySelector('.product-title').textContent;
                    let productPrice = productCard.querySelector('.product-price').textContent.trim().split('\n')[0].trim();
                    
                    // Extract badge if present
                    let badge = '';
                    const badgeElement = productCard.querySelector('.product-badge');
                    if (badgeElement) {
                        badge = badgeElement.textContent;
                    }
                    
                    // Find image URL if present
                    let imageUrl = '';
                    const imageElement = productCard.querySelector('.product-image img');
                    if (imageElement) {
                        imageUrl = imageElement.src;
                    }
                    
                    // Find original price if present
                    let originalPrice = '';
                    const originalPriceElement = productCard.querySelector('.original-price');
                    if (originalPriceElement) {
                        originalPrice = originalPriceElement.textContent.trim();
                    }
                    
                    // Find rating if present
                    let rating = 0;
                    const ratingStars = productCard.querySelectorAll('.rating-stars .fas.fa-star').length;
                    const ratingHalfStars = productCard.querySelectorAll('.rating-stars .fas.fa-star-half-alt').length;
                    rating = ratingStars + (ratingHalfStars * 0.5);
                    
                    // Find rating count if present
                    let ratingCount = '';
                    const ratingCountElement = productCard.querySelector('.rating-count');
                    if (ratingCountElement) {
                        ratingCount = ratingCountElement.textContent.trim();
                    }
                    
                    // Extract hidden features
                    const features = [];
                    const hiddenFeatures = productCard.querySelectorAll('.hidden-features .feature');
                    if (hiddenFeatures.length > 0) {
                        hiddenFeatures.forEach(feature => {
                            if (feature.value) {
                                features.push(feature.value);
                            }
                        });
                    }
                    
                    let productDescription = '';
                    const descriptionElement = productCard.querySelector('.hidden-features .description');
                    if (descriptionElement) {
                        productDescription = descriptionElement.value.trim();
                    }
                    
                    // Generate a unique ID using the product title
                    const productId = 'prod*' + productTitle.replace(/\s+/g, '*').toLowerCase().substring(0, 15);
                    
                    // Create product object to save to localStorage
                    const productData = {
                        id: productId,
                        title: productTitle,
                        price: productPrice,
                        originalPrice: originalPrice,
                        imageUrl: imageUrl,
                        badge: badge,
                        rating: rating,
                        ratingCount: ratingCount,
                        features: features,
                        description: productDescription
                    };
                    
                    // Save the selected product to localStorage
                    localStorage.setItem('selectedProduct', JSON.stringify(productData));
                    
                    // Redirect to the item details page
                    window.location.href = '/components/item.html';
                });
            });
        }

        // Hide loading state
        function hideLoading() {
            const loadingState = document.getElementById('loadingState');
            loadingState.style.display = 'none';
        }

       // Show no products message
        function showNoProducts(message) {
            const noProducts = document.getElementById('noProducts');
            const productGrid = document.getElementById('productGrid');
            
            productGrid.style.display = 'none';
            noProducts.style.display = 'block';
            
            if (message) {
                noProducts.querySelector('p').textContent = message;
            }
        }

        // Update cart count (placeholder function)
        function updateCartCount() {
            // This would typically get the cart count from localStorage
            const cartCount = document.getElementById('cartCount');
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            cartCount.textContent = cart.length;
        }

        // Mobile menu toggle (placeholder function)
        function toggleMobileMenu() {
            const navSection = document.getElementById('navSection');
            navSection.classList.toggle('active');
        }
    </script>
    <script src="../js/navbar.js"></script>
</body>
</html>